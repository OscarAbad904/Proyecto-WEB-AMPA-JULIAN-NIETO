{% extends "public/layout.html" %}

{% block title %}{{ meeting.title if meeting else "Nueva reunión" }} | {{ commission.name }}{% endblock %}

{% block content %}
<section class="page-section">
  <div class="container">
    <header class="section-header">
      <p class="eyebrow">Comisión: {{ commission.name }}</p>
      <h1 class="section-title">{{ meeting.title if meeting else "Nueva reunión" }}</h1>
      {% if meeting %}
      <p class="text-muted">Creada: {{ meeting.created_at.strftime("%d/%m/%Y %H:%M") }}</p>
      <p class="text-muted">Última actualización: {{ meeting.updated_at.strftime("%d/%m/%Y %H:%M") }}</p>
      {% endif %}
    </header>
    
    <div class="card">
      <form method="post">
        {{ form.hidden_tag() }}
        
        <div class="form-group">
          {{ form.title.label(class="form-label") }}
          {{ form.title(class="form-control", placeholder="p.ej. Reunión de planificación Q1") }}
          {% if form.title.errors %}
          <div class="form-error">
            {% for error in form.title.errors %}
            <p>{{ error }}</p>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="form-group">
          {{ form.description.label(class="form-label") }}
          {{ form.description(class="form-control", rows="5", placeholder="Agenda, temas a tratar, etc.") }}
          <small class="text-muted">Puedes usar HTML básico para dar formato.</small>
          {% if form.description.errors %}
          <div class="form-error">
            {% for error in form.description.errors %}
            <p>{{ error }}</p>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="form-row">
          <div class="form-group">
            {{ form.start_at.label(class="form-label") }}
            {{ form.start_at(class="form-control") }}
            {% if form.start_at.errors %}
            <div class="form-error">
              {% for error in form.start_at.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          
          <div class="form-group">
            {{ form.end_at.label(class="form-label") }}
            {{ form.end_at(class="form-control") }}
            {% if form.end_at.errors %}
            <div class="form-error">
              {% for error in form.end_at.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        
        <div class="form-group">
          {{ form.location.label(class="form-label") }}
          {{ form.location(class="form-control", placeholder="Presencial, online, etc.") }}
          {% if form.location.errors %}
          <div class="form-error">
            {% for error in form.location.errors %}
            <p>{{ error }}</p>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="form-group">
          {{ form.minutes_document_id.label(class="form-label") }}
          {{ form.minutes_document_id(class="form-control") }}
          <small class="text-muted">Vincula el acta de la reunión si está disponible.</small>
          {% if form.minutes_document_id.errors %}
          <div class="form-error">
            {% for error in form.minutes_document_id.errors %}
            <p>{{ error }}</p>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="form-actions">
          {{ form.submit(class="btn-primary", value="Guardar reunión") }}
          <a class="btn-link" href="{{ url_for('members.commission_detail', slug=commission.slug) }}">Cancelar</a>
          {% if meeting %}
          <form method="post" action="{{ url_for('members.commission_meeting_delete', slug=commission.slug, meeting_id=meeting.id) }}" style="display:inline;" data-confirm="{{ '¿Estás seguro de que quieres eliminar esta reunión? Esta acción no se puede deshacer.' | e }}" data-confirm-title="Eliminar reunión" data-confirm-accept="Eliminar" data-confirm-variant="danger">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn-link danger">Eliminar reunión</button>
          </form>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
</section>
{% endblock %}
