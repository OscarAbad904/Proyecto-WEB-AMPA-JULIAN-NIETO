<!doctype html>
<html lang="es" data-theme="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/design-tokens.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.png') }}" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}" />
  <meta name="theme-color" content="#F2F7F4" />
  <meta property="og:site_name" content="AMPA Julián Nieto Tapia" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="es_ES" />
  <title>{% block title %}AMPA Julián Nieto Tapia{% endblock %}</title>
  {% block meta %}{% endblock %}
  {% block head %}{% endblock %}
</head>

<body>
  <!-- Page Loading Spinner -->
  <div class="page-loader" id="pageLoader">
    <div class="page-loader__content">
      <div class="page-loader__spinner"></div>
    </div>
  </div>

  {% include 'includes/_nav.html' %}
  <main class="layout">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-stack flash-stack--global" role="status" aria-live="polite">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>
  {% include 'includes/_footer.html' %}
  <style>
    .flash-stack {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin: 0.75rem auto 1.2rem;
      width: min(1100px, calc(100% - 2rem));
    }

    .flash {
      padding: 0.75rem 1rem;
      border-radius: 12px;
      font-weight: 600;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(10, 19, 33, 0.9);
      color: #f8fafc;
    }

    .flash-success {
      border-color: rgba(34, 197, 94, 0.45);
      background: rgba(16, 185, 129, 0.12);
      color: #34d399;
    }

    .flash-warning {
      border-color: rgba(250, 204, 21, 0.4);
      background: rgba(250, 204, 21, 0.12);
      color: #facc15;
    }

    .flash-info {
      border-color: rgba(59, 130, 246, 0.35);
      background: rgba(59, 130, 246, 0.12);
      color: #60a5fa;
    }

    .flash-danger,
    .flash-error {
      border-color: rgba(239, 68, 68, 0.4);
      background: rgba(239, 68, 68, 0.12);
      color: #f87171;
    }
  </style>
  <script defer src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/nav.js') }}"></script>

  <!-- Page Loader Script -->
  <script>
    (function () {
      const loader = document.getElementById('pageLoader');

      // Ocultar loader cuando la página esté completamente cargada
      window.addEventListener('load', function () {
        loader.classList.remove('active');
      });

      document.addEventListener('DOMContentLoaded', function () {
        loader.classList.remove('active');
      });

      window.setTimeout(function () {
        loader.classList.remove('active');
      }, 6000);

      // Mostrar loader al hacer clic en enlaces internos
      document.addEventListener('click', function (e) {
        const link = e.target.closest('a');
        if (!link) return;

        const href = link.getAttribute('href');

        // Ignorar enlaces externos, anclas, javascript:, mailto:, tel:
        if (!href ||
          href.startsWith('#') ||
          href.startsWith('javascript:') ||
          href.startsWith('mailto:') ||
          href.startsWith('tel:') ||
          link.target === '_blank' ||
          link.hasAttribute('download') ||
          e.ctrlKey || e.metaKey || e.shiftKey) {
          return;
        }

        // Ignorar enlaces externos
        try {
          const url = new URL(href, window.location.origin);
          if (url.origin !== window.location.origin) return;
        } catch (err) {
          // Si no es una URL válida, continuar
        }

        // Mostrar el loader
        loader.classList.add('active');
      });

      // Mostrar loader al enviar formularios (excepto AJAX)
      document.addEventListener('submit', function (e) {
        const form = e.target;
        // Si el formulario no tiene data-no-loader, mostrar el loader
        if (!form.hasAttribute('data-no-loader') && !form.hasAttribute('data-ajax')) {
          loader.classList.add('active');
        }
      });

      // Ocultar loader si el usuario vuelve atrás con el navegador
      window.addEventListener('pageshow', function (e) {
        if (e.persisted) {
          loader.classList.remove('active');
        }
      });
    })();
  </script>

  {% block scripts %}{% endblock %}
</body>

</html>
