{% extends "public/layout.html" %}

{% block title %}Miembros | {{ commission.name }}{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}" />
{% endblock %}

{% block content %}
<section class="admin-wrapper">
  <div class="admin-header">
    <p class="admin-kicker">Comisiones · Administración</p>
    <h1 class="admin-title">Miembros de {{ commission.name }}</h1>
    <p class="admin-subtitle">Añade responsables, define su rol y activa o desactiva miembros según su participación.</p>
  </div>

  <div class="admin-card">
    <form method="post" class="admin-form">
      {{ form.hidden_tag() }}
      <div class="field-row">
        <div class="field">
          {{ form.user_id.label }}
          {{ form.user_id() }}
        </div>
        <div class="field">
          {{ form.role.label }}
          {{ form.role() }}
        </div>
      </div>
      <div class="field">
        <label class="checkbox-inline">
          {{ form.is_active() }} <span>Activo</span>
        </label>
      </div>
      <div class="admin-actions">
        {{ form.submit(class="btn-primary") }}
        <a class="btn-link" href="{{ url_for('admin.commissions_index') }}">Volver</a>
      </div>
    </form>
  </div>

  <div class="admin-card">
    <div class="table-responsive">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Rol</th>
            <th>Estado</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
          <tr>
            <td>{{ member.user.username }}</td>
            <td>{{ member.role }}</td>
            <td>
              <span class="chip {% if member.is_active %}chip-live{% else %}chip-off{% endif %}">
                {{ "Activo" if member.is_active else "Inactivo" }}
              </span>
            </td>
            <td>
              {% if member.is_active %}
              <form method="post" action="{{ url_for('admin.commission_member_disable_admin', commission_id=commission.id, membership_id=member.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn-link">Desactivar</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="muted">Sin miembros.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
