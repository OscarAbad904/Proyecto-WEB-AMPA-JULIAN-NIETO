{% extends "public/layout.html" %}

{% block title %}Eventos · AMPA Julián Nieto{% endblock %}

{% block content %}
  <section class="events-section">
    <div class="container">
      <div class="events-header">
        <div class="fade-in">
          <p class="eyebrow">Próximos eventos</p>
          <h1 class="events-title">Actividades destacadas</h1>
          <p class="events-desc">Participa en nuestras actividades pensadas para toda la comunidad educativa.</p>
        </div>
        <div class="nav-buttons fade-in">
          <button class="nav-button" onclick="scrollEvents(-1)">←</button>
          <button class="nav-button" onclick="scrollEvents(1)">→</button>
        </div>
      </div>

      <div class="events-grid fade-in">
        {% if featured_events %}
          {% for event in featured_events %}
          <div class="event-card">
            {% if event.cover_image %}
            <div class="event-cover" style="background-image: url('{{ event.cover_image }}');"></div>
            {% else %}
            <div class="event-cover event-cover-{{ loop.index }}"></div>
            {% endif %}
            <div class="event-content">
              <p class="event-category {% if loop.index == 2 %}orange{% elif loop.index == 3 %}green{% endif %}">
                {{ event.category|title if event.category else 'Evento' }}
              </p>
              <h3 class="event-title">{{ event.title }}</h3>
              <p class="event-desc">{{ event.description_html|striptags|truncate(120) }}</p>
              <div class="event-meta">
                <span>{{ event.start_at.strftime('%d %b %Y') }}</span>
                <span>{{ event.start_at.strftime('%H:%M') }}{% if event.location %} - {{ event.location }}{% endif %}</span>
              </div>
              <a class="btn-outline" href="{{ url_for('public.evento_detalle', slug=event.slug) }}">Ver detalle</a>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="alert">
            <p>No hay eventos próximos disponibles en este momento.</p>
          </div>
        {% endif %}
      </div>

      <div class="events-footer fade-in">
        <div>
          <p class="events-desc">Consulta todas las fechas y actividades programadas en el calendario.</p>
          {% if can_view_calendar %}
          <a class="btn-primary" href="{{ calendar_href }}">Ver calendario completo</a>
          {% endif %}
        </div>
        <div class="events-calendar" id="eventos-mini-calendario">
          <!-- Contenido dinámico cargado por JavaScript -->
          <div class="loading-indicator" style="text-align: center; padding: 2rem;">
            Cargando próximos eventos...
          </div>
        </div>
        <div style="margin-top:1.5rem;">
          {% if calendar_id %}
          <iframe src="https://calendar.google.com/calendar/embed?src={{ calendar_id|urlencode }}&ctz=Europe%2FMadrid"
                  style="border: 0; width: 100%; height: 400px;" frameborder="0" scrolling="no"></iframe>
          {% else %}
          <div class="alert">
            Publica eventos desde el panel de administracion para mostrarlos aqui.
          </div>
          {% endif %}
        </div>
      </div>

      <div class="event-form fade-in">
        <h3 class="event-form-title">Inscripción a Eventos</h3>
        <form onsubmit="handleEventForm(event)">
          <label>Evento</label>
          <select required>
            <option>Fiesta de Navidad solidaria</option>
            <option>Charla "Los Sitios de Zaragoza"</option>
            <option>Torneo de Ajedrez “San Valero”</option>
          </select>
          <label>Nombre completo</label>
          <input type="text" required>
          <label>Email</label>
          <input type="email" required>
          <label>Número de asistentes</label>
          <input type="number" min="1" required>
          <button type="submit">Inscribirse</button>
        </form>
      </div>
    </div>
  </section>

  <script src="{{ url_for('static', filename='js/eventos_mini_calendario.js') }}"></script>
{% endblock %}
